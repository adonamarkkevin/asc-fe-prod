(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{"5h0i":function(e,t,n){"use strict";n.r(t),n.d(t,"WeeklyUserScheduleModule",(function(){return M}));var a=n("ofXK"),s=n("tk/3"),i=n("3Pt+"),r=n("M0ag"),l=n("7Tf7"),d=n("tyNb"),c=n("sWYD"),o=n("+0xr"),u=n("fXoL"),m=n("dJ3e"),h=n("kmnG"),p=n("bTqV"),f=n("d3UM"),y=n("FKr1"),D=n("iadO");const S=["calendar"];function w(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"mat-option",18),u["\u0275\u0275listener"]("click",(function(){u["\u0275\u0275restoreView"](e);const n=t.$implicit;return u["\u0275\u0275nextContext"](2).onSelectUser(n)})),u["\u0275\u0275text"](1),u["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;u["\u0275\u0275property"]("value",e),u["\u0275\u0275advance"](1),u["\u0275\u0275textInterpolate1"](" ",e.firstName+" "+e.lastName," ")}}function g(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"div",14),u["\u0275\u0275elementStart"](1,"mat-calendar",19,20),u["\u0275\u0275listener"]("selectedChange",(function(t){u["\u0275\u0275restoreView"](e);const n=u["\u0275\u0275reference"](2);return u["\u0275\u0275nextContext"](2).onCalendarUpdate(t,n)})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}if(2&e){const e=u["\u0275\u0275nextContext"](2);u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("minDate",e.todayDate)("hidden",!e.selectedUser)("dateClass",e.isSelected(e))}}function v(e,t){if(1&e&&(u["\u0275\u0275elementStart"](0,"div",1),u["\u0275\u0275elementStart"](1,"mat-form-field",14),u["\u0275\u0275elementStart"](2,"mat-label"),u["\u0275\u0275text"](3,"ASC Internal User"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](4,"mat-select",15),u["\u0275\u0275template"](5,w,2,2,"mat-option",16),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](6,g,3,3,"div",17),u["\u0275\u0275elementEnd"]()),2&e){const e=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](5),u["\u0275\u0275property"]("ngForOf",e.users),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("ngIf",e.users)}}function b(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"th",21),u["\u0275\u0275text"](1," Date "),u["\u0275\u0275elementEnd"]())}function U(e,t){if(1&e){const e=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"td",22),u["\u0275\u0275elementStart"](1,"button",23),u["\u0275\u0275listener"]("click",(function(){u["\u0275\u0275restoreView"](e);const n=t.$implicit;return u["\u0275\u0275nextContext"]().deleteDate(null==n?null:n.date)})),u["\u0275\u0275text"](2,"Delete"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](3,"span",24),u["\u0275\u0275text"](4),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit,n=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](4),u["\u0275\u0275textInterpolate"](n.convertDate(null==e?null:e.date))}}function x(e,t){1&e&&u["\u0275\u0275element"](0,"tr",25)}function E(e,t){1&e&&u["\u0275\u0275element"](0,"tr",26)}const C=[{path:"",component:(()=>{class e{constructor(e){this.apiService=e,this.selectedDates=[],this.originalUserDates=[],this.userExistingRecord=null,this.displayedColumns=["date"]}ngOnInit(){this.initializeUsers(),this.todayDate=new Date}onCalendarUpdate(e,t){const n=Object(c.a)(e,"yyyy-MM-dd");if(!this.originalUserDates.find(e=>e===n)){if(this.selectedDates.find(e=>e===n)){const e=this.selectedDates.findIndex(e=>e===n);this.selectedDates.splice(e,1)}else this.selectedDates.push(n);this.calendar.updateTodaysDate(),this.updateDataSource()}}onSelectUser(e){this.selectedUser=e,this.initializeUserDates(this.selectedUser)}isSelected(e){return t=>{var n;return Boolean(null===(n=e.selectedDates)||void 0===n?void 0:n.find(e=>Object(c.a)(t,"yyyy-MM-dd")===e))?"selected":null}}saveSelectedDates(){const e={account:this.selectedUser,weeklyUserScheduleDates:this.convertSelectedDates(),id:this.userExistingRecord?this.userExistingRecord.id:null};this.userExistingRecord?this.apiService.update(r.n.weeklyUserSchedule,e).subscribe(()=>{this.initializeUserDates(this.selectedUser)}):this.apiService.insert(r.n.weeklyUserSchedule,Object.assign(Object.assign({},e),{weeklyUserScheduleDates:[]}),!0).subscribe(t=>{this.apiService.update(r.n.weeklyUserSchedule,Object.assign(Object.assign({},e),{id:t.responseData.data.id})).subscribe(()=>{this.initializeUserDates(this.selectedUser)})})}convertDate(e){return Object(c.a)(new Date(e),"MMM/dd/yyyy")}deleteDate(e){const t=this.originalUserDates.findIndex(t=>t===e);if(-1!==t){const n=this.userExistingRecord.weeklyUserScheduleDates.find(t=>Object(c.a)(new Date(t.scheduleDate),"yyyy-MM-dd")===Object(c.a)(new Date(e),"yyyy-MM-dd")).id;this.apiService.deleteById(r.n.weeklyScheduledUsers,n).subscribe(()=>{const a=this.userExistingRecord.weeklyUserScheduleDates.findIndex(e=>e.id===n);this.userExistingRecord.weeklyUserScheduleDates.splice(a,1),this.deletionUpdate(e),this.originalUserDates.splice(t,1)})}else this.deletionUpdate(e)}deletionUpdate(e){const t=this.selectedDates.findIndex(t=>t===e);this.selectedDates.splice(t,1),this.updateDataSource(),this.calendar.updateTodaysDate()}updateDataSource(){this.dataSource=new o.p(this.selectedDates.sort((e,t)=>new Date(t).valueOf()-new Date(e).valueOf()).map(e=>({date:e})))}convertSelectedDates(){return this.selectedDates.map(e=>{let t=null;return this.userExistingRecord&&(t=this.userExistingRecord.weeklyUserScheduleDates.find(t=>Object(c.a)(new Date(t.scheduleDate),"yyyy-MM-dd")===Object(c.a)(new Date(e),"yyyy-MM-dd"))),null!=t?t:{scheduleDate:e}})}initializeUsers(){this.apiService.findAll(r.n.userAccountType+"/ASC_USER").subscribe(e=>{this.users=e.responseData.data})}clearData(){this.selectedDates=[],this.originalUserDates=[],this.calendar.updateTodaysDate(),this.updateDataSource()}initializeUserDates(e){this.clearData(),this.apiService.findAll(`${r.n.weeklyUserScheduleCustomSearch}?&accountId=${e.id}`).subscribe(e=>{e.data.length?(this.originalUserDates=(e=e.data[0]).weeklyUserScheduleDates.map(e=>Object(c.a)(new Date(e.scheduleDate),"yyyy-MM-dd")),this.selectedDates=[...this.originalUserDates],this.userExistingRecord=e,this.updateDataSource(),this.calendar.updateTodaysDate()):this.userExistingRecord=null})}}return e.\u0275fac=function(t){return new(t||e)(u["\u0275\u0275directiveInject"](m.b))},e.\u0275cmp=u["\u0275\u0275defineComponent"]({type:e,selectors:[["app-weekly-user-schedule"]],viewQuery:function(e,t){var n;1&e&&u["\u0275\u0275viewQuery"](S,!0),2&e&&u["\u0275\u0275queryRefresh"](n=u["\u0275\u0275loadQuery"]())&&(t.calendar=n.first)},decls:21,vars:6,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-12","title"],["class","row",4,"ngIf"],[1,"mat-elevation-z8","fields"],["mat-table","","mat-sort","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"no-record",3,"hidden"],[1,"col-md-12"],["mat-raised-button","",1,"button-red","col-md-3","margin",3,"hidden","click"],["appearance","outline",1,"col-md-5"],["name","status"],[3,"value","click",4,"ngFor","ngForOf"],["class","col-md-5","appearance","outline",4,"ngIf"],[3,"value","click"],[3,"minDate","hidden","dateClass","selectedChange"],["calendar",""],["mat-header-cell",""],["mat-cell",""],["mat-raised-button","",1,"button-red","col-md-1","delete-btn",3,"click"],[1,"date-text"],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"form"),u["\u0275\u0275elementStart"](1,"div",0),u["\u0275\u0275elementStart"](2,"div",1),u["\u0275\u0275elementStart"](3,"div",2),u["\u0275\u0275elementStart"](4,"mat-label"),u["\u0275\u0275text"](5," Weekly User Schedule "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](6,"hr"),u["\u0275\u0275elementStart"](7,"form"),u["\u0275\u0275template"](8,v,7,2,"div",3),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](9,"div",4),u["\u0275\u0275elementStart"](10,"table",5),u["\u0275\u0275elementContainerStart"](11,6),u["\u0275\u0275template"](12,b,2,0,"th",7),u["\u0275\u0275template"](13,U,5,1,"td",8),u["\u0275\u0275elementContainerEnd"](),u["\u0275\u0275template"](14,x,1,0,"tr",9),u["\u0275\u0275template"](15,E,1,0,"tr",10),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](16,"div",11),u["\u0275\u0275text"](17," No record found. "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](18,"div",12),u["\u0275\u0275elementStart"](19,"button",13),u["\u0275\u0275listener"]("click",(function(){return t.saveSelectedDates()})),u["\u0275\u0275text"](20,"Save"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275advance"](8),u["\u0275\u0275property"]("ngIf",t.users),u["\u0275\u0275advance"](2),u["\u0275\u0275property"]("dataSource",t.dataSource),u["\u0275\u0275advance"](4),u["\u0275\u0275property"]("matHeaderRowDef",t.displayedColumns),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("matRowDefColumns",t.displayedColumns),u["\u0275\u0275advance"](1),u["\u0275\u0275property"]("hidden",t.selectedDates&&t.selectedDates.length>0),u["\u0275\u0275advance"](3),u["\u0275\u0275property"]("hidden",0===t.selectedDates.length))},directives:[i.J,i.u,i.v,h.g,a.t,o.o,o.c,o.i,o.b,o.k,o.n,p.b,h.c,f.a,a.s,y.m,D.a,o.h,o.a,o.j,o.m],styles:[".mat-calendar-body-cell.selected{background-color:#c5140c!important;border-radius:50%}.drop-calendar{width:30rem}.margin{margin:10px!important;right:0!important;bottom:0!important}.delete-btn{float:right!important}.date-text{font-size:larger;margin:auto}"],encapsulation:2}),e})()}];let k=(()=>{class e{}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[d.f.forChild(C)],d.f]}),e})(),M=(()=>{class e{}return e.\u0275mod=u["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.c,k,s.b,i.D,r.k,l.a]]}),e})()},"7Tf7":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("ofXK"),s=n("M0ag"),i=n("tyNb"),r=n("fXoL");const l=[];let d=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[i.f.forChild(l)],i.f]}),e})(),c=(()=>{class e{}return e.\u0275mod=r["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=r["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.c,d,s.k]]}),e})()}}]);